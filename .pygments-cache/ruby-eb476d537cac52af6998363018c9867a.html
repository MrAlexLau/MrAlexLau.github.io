<div class="highlight"><pre><span class="c1"># stub_chain takes in a list of subobject names, and one method name</span>
<span class="c1"># returns an object with each of those subobjects nested into each other</span>
<span class="c1"># and mocks a method that returns nil for the last argument</span>

<span class="c1"># eg - obj = stub_chain(%w{ account sms messages create })</span>
<span class="c1"># returns an object that stubs this method call:</span>
<span class="c1"># obj.account.sms.messages.create</span>
<span class="c1"># and returns nil</span>
<span class="k">def</span> <span class="nf">stub_chain</span><span class="p">(</span><span class="n">method_chain</span><span class="p">)</span>
  <span class="k">return</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">method_chain</span><span class="o">.</span><span class="n">empty?</span>

  <span class="n">next_object_name</span> <span class="o">=</span> <span class="n">method_chain</span><span class="o">.</span><span class="n">shift</span>
  <span class="n">obj</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">stub</span><span class="p">(</span><span class="n">next_object_name</span><span class="o">.</span><span class="n">to_sym</span><span class="p">)</span><span class="o">.</span><span class="n">and_return</span><span class="p">(</span><span class="n">stub_chain</span><span class="p">(</span><span class="n">method_chain</span><span class="p">))</span>
  <span class="n">obj</span>
<span class="k">end</span>
</pre></div>